<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<title>erp-coors</title>

<div th:replace="fragments/header :: header-css" />

<!-- JS file https://www.jsdelivr.com/package/npm/easy-autocomplete?path=dist  -->
<script src="https://cdn.jsdelivr.net/npm/easy-autocomplete@1.3.5/dist/jquery.easy-autocomplete.min.js"></script>

<!-- CSS file -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/easy-autocomplete@1.3.5/dist/easy-autocomplete.min.css"> </link>

<!-- Additional CSS Themes file - not required-->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/easy-autocomplete@1.3.5/dist/easy-autocomplete.themes.min.css"> </link>

<script type="text/javascript">
$(document).ready(function(){
	// Sugestions on clients
	var options = {
		placeholder: "Nome ou ID do cliente",
		requestDelay: 500,
		url: function(phrase) {
			return "../clientes/filtrar?phrase=" + phrase;
		},
		getValue: "name",
		list: {
			onSelectItemEvent: function() {
				var id = $("#cli_name").getSelectedItemData().id;
				var cpf = $("#cli_name").getSelectedItemData().cpf_cnpj;

				$("#cli_id").val(id).trigger("change");
				$("#cli_cpf").val(cpf).trigger("change");
			},
			onLoadEvent: function() {
				$("#cli_id").val("").trigger("change");
				$("#cli_cpf").val("").trigger("change");
			},
			showAnimation: {
				type: "fade", //normal|slide|fade
				time: 400,
				callback: function() {}
			},
			hideAnimation: {
				type: "slide", //normal|slide|fade
				time: 400,
				callback: function() {}
			}
		}
	};

	$("#cli_name").easyAutocomplete(options);
	
	// TODO: Sugestions on products
});
</script>
</head>

<body>
	<div th:replace="fragments/header :: header" />

	<div class="container">
		<div class="row" style="text-align: center; padding-bottom: 40px;">
			<h1>Or√ßamento</h1>
		</div>
		<div class="row">
			<form th:action="@{/orcamentos/novo}" th:object="${order}"
				method="POST">

				<div class="form-group row">
					<div class="alert alert-danger" th:if="${#fields.hasAnyErrors()}">
						<div th:each="detailedError : ${#fields.detailedErrors()}">
							<span th:text="${detailedError.message}"></span>
						</div>
					</div>
				</div>
				<div class="form-group row">
					<div class="col-md-1">
						<input type="text" class="form-control input-sm" id="id"
							th:field="*{id}" readOnly="readonly" />
					</div>
				</div>

				<div class="form-group row">
					<label for="name" class="col-sm-1 col-form-label">Cliente</label>
					<div class="col-sm-8">
						<input type="text" class="form-control" id="cli_name"
							th:field="*{client.name}" placeholder="Cliente"> </input>
					</div>
					
					<div class="col-sm-1">
						<input type="text" class="form-control" id="cli_id" readOnly="readonly"
							th:field="*{client.id}"> </input>
					</div>
					
					<div class="col-sm-2">
						<input type="text" class="form-control" id="cli_cpf" readOnly="readonly"
							th:field="*{client.cpf_cnpj}"> </input>
					</div>
				</div>

				<div class="form-group row">
					<label for="name" class="col-sm-1 col-form-label">Num. Prod.:</label>
					<div class="col-sm-2">
						<input type="text" class="form-control" id="cli_id" readOnly="readonly"
							> </input>
					</div>
					
					<label for="name" class="col-sm-1 col-form-label">Valor:</label>
					<div class="col-sm-2">
						<input type="text" class="form-control" id="cli_id" readOnly="readonly"
							th:field="*{fullValue}"> </input>
					</div>
					
					<label for="name" class="col-sm-1 col-form-label">Desconto:</label>
					<div class="col-sm-2">
						<input type="text" class="form-control" id="cli_id"
							th:field="*{discount}"> </input>
					</div>
					
					<label for="name" class="col-sm-1 col-form-label">Valor Final:</label>
					<div class="col-sm-2">
						<input type="text" class="form-control" id="cli_id" readOnly="readonly"
							th:field="*{value}"> </input>
					</div>
				</div>
				
				<div class="row" style="text-align: center; padding-bottom: 40px;">
					<h3>Produto</h3>
				</div>
				
				<div class="form-group row">
					<label for="name" class="col-sm-1 col-form-label">Produto:</label>
					<div class="col-sm-5">
						<input type="text" class="form-control" id="prod_add"
							placeholder="Produto a adicionar"> </input>
						<input type="hidden" class="form-control" id="prod_add_id"
							> </input>
					</div>
					
					<div class="col-sm-1">
						<input type="text" class="form-control" id="prod_medida" placeholder="Kg" readOnly="readonly"
							> </input>
					</div>
					
					<label for="name" class="col-sm-1 col-form-label">Quantidade:</label>
					<div class="col-sm-1">
						<input type="text" class="form-control" id="prod_qnt"
							> </input>
					</div>
					
					<label for="name" class="col-sm-1 col-form-label">Valor Total:</label>
					<div class="col-sm-1">
						<input type="text" class="form-control" id="prod_v_total"
							> </input>
					</div>
					
					<div class="col-sm-1">
						<button type="submit" name="add_prod" class="btn btn-primary">Adicionar</button>
					</div>
				</div>
				
				<div class="row" style="text-align: center; padding-bottom: 40px;">
					<h3>Lista de Produtos Adicionados</h3>
				</div>
				
				<div class="form-group row" th:each="prod, rowStat : *{products}">
					<!-- 
					<label for="phone1" class="col-sm-1 col-form-label">Telefone 
						</label>
					 <div class="col-sm-10">
						<input type="text" class="form-control"
							th:field="*{phones[__${rowStat.index}__].phone}" placeholder="Telefone"> </input>
						<input type="hidden" class="form-control" th:field="*{phones[__${rowStat.index}__].id}" 
						    th:value="*{phones[__${rowStat.index}__].id}"> </input> 
					</div>
					<div class="col-sm-1 row-delete-button">
                           <button type="submit" class="btn btn-default"
                                   th:value="*{phones[__${rowStat.index}__].id}"
                                   name="rmContactPhone">
                               <i class="glyphicon glyphicon-trash icon-white"></i>
                           </button>
                        </div>
                   -->
				</div>
				
				<div class="form-group row">
					<div class="col-sm-10">
						<button type="submit" name="newOrder" class="btn btn-primary">Gravar</button>
					</div>
				</div>

			</form>
		</div>
	</div>

	<div th:replace="fragments/footer :: footer" />

</body>
</html>